// Generated by EmberScript 0.0.7
var get$=Ember.get;Em.onLoad("Ember.Application",function(e){return e.initializer({name:"ember-auth",initialize:function(e,t){return t.register("auth:main",get$(t,"Auth")||get$(Em,"Auth"),{singleton:!0}),t.inject("route","auth","auth:main"),t.inject("controller","auth","auth:main"),t.inject("view","auth","auth:main")}}),e.initializer({name:"ember-auth-load",after:"ember-auth",initialize:function(e,t){return e.lookup("auth:main")}})}),void function(){var e,t=Ember.get,n=Ember.set;e=jQuery,n(Em,"Auth",Ember.Object.extend({_defaults:{},_config:function(n,r){return null!=r?function(e){var i,s;for(i in r)s=r[i],t(this,"_defaults")[n]||(t(this,"_defaults")[n]={}),e.push(t(this,"_defaults")[n][i]=s);return e}.call(this,[]):e.extend(!0,{},t(this,"_defaults")[n],this.get(n))},_handlers:{signInSuccess:[],signInError:[],signOutSuccess:[],signOutError:[],sendSuccess:[],sendError:[]},module:Ember.computed(function(){var e,n;n={};for(var r=0,i=t(this,"modules").length;r<i;++r)e=t(this,"modules")[r],n[e]=t(this,"container").lookup("authModule:"+e);return n}).property("modules.@each"),_request:Ember.computed(function(){return t(this,"container").lookup("authRequest:"+t(this,"request"))}).property("request"),_response:Ember.computed(function(){return t(this,"container").lookup("authResponse:"+t(this,"response"))}).property("response"),_strategy:Ember.computed(function(){return t(this,"container").lookup("authStrategy:"+t(this,"strategy"))}).property("strategy"),_session:Ember.computed(function(){return t(this,"container").lookup("authSession:"+t(this,"session"))}).property("session"),signIn:function(e,n){var r;return typeof n=="undefined"?(n=e,e=t(this,"_request").resolveUrl(t(this,"signInEndPoint"))):e=t(this,"_request").resolveUrl(e),n||(n={}),new(t(t(Em,"RSVP"),"Promise"))((r=this,function(i,s){var o,u;return t(r,"_request").signIn(e,t(r,"_strategy").serialize(n)).then((o=r,function(e){var n,r,u;n=t(o,"_response").canonicalize(e),u=[],u.push(t(o,"_strategy").deserialize(n)),u.push(t(o,"_session").start(n));for(var a=0,f=t(t(o,"_handlers"),"signInSuccess").length;a<f;++a)r=t(t(o,"_handlers"),"signInSuccess")[a],u.push(r(n));return t(Em,"RSVP").all(u).then(function(){return i(n)}).fail(function(){return s(n)})})).fail((u=r,function(e){var n,r,i;n=t(u,"_response").canonicalize(e),i=[],i.push(t(u,"_strategy").deserialize(n)),i.push(t(u,"_session").end(n));for(var o=0,a=t(t(u,"_handlers"),"signInError").length;o<a;++o)r=t(t(u,"_handlers"),"signInError")[o],i.push(r(n));return t(Em,"RSVP").all(i).then(function(){return s(n)}).fail(function(){return s(n)})}))}))},signOut:function(e,n){var r;return typeof n=="undefined"?(n=e,e=t(this,"_request").resolveUrl(t(this,"signOutEndPoint"))):e=t(this,"_request").resolveUrl(e),n||(n={}),new(t(t(Em,"RSVP"),"Promise"))((r=this,function(i,s){var o,u;return t(r,"_request").signOut(e,t(r,"_strategy").serialize(n)).then((o=r,function(e){var n,r,u;n=t(o,"_response").canonicalize(e),u=[],u.push(t(o,"_strategy").deserialize(n)),u.push(t(o,"_session").end(n));for(var a=0,f=t(t(o,"_handlers"),"signOutSuccess").length;a<f;++a)r=t(t(o,"_handlers"),"signOutSuccess")[a],u.push(r(n));return t(Em,"RSVP").all(u).then(function(){return i(n)}).fail(function(){return s(n)})})).fail((u=r,function(e){var n,r,i;n=t(u,"_response").canonicalize(e),i=[];for(var o=0,a=t(t(u,"_handlers"),"signOutError").length;o<a;++o)r=t(t(u,"_handlers"),"signOutError")[o],i.push(r(n));return t(Em,"RSVP").all(i).then(function(){return s(n)}).fail(function(){return s(n)})}))}))},send:function(e,n){var r;return typeof n=="undefined"?(n=e,e=t(this,"_request").resolveUrl("")):e=t(this,"_request").resolveUrl(e),n||(n={}),new(t(t(Em,"RSVP"),"Promise"))((r=this,function(i,s){var o,u;return t(r,"_request").send(e,t(r,"_strategy").serialize(n)).then((o=r,function(e){var n,r;r=[];for(var u=0,a=t(t(o,"_handlers"),"sendSuccess").length;u<a;++u)n=t(t(o,"_handlers"),"sendSuccess")[u],r.push(n(e));return t(Em,"RSVP").all(r).then(function(){return i(e)}).fail(function(){return s(e)})})).fail((u=r,function(e){var n,r;r=[];for(var i=0,o=t(t(u,"_handlers"),"sendError").length;i<o;++i)n=t(t(u,"_handlers"),"sendError")[i],r.push(n(e));return t(Em,"RSVP").all(r).then(function(){return s(e)}).fail(function(){return s(e)})}))}))},createSession:function(e){var n;return new(t(t(Em,"RSVP"),"Promise"))((n=this,function(r,i){var s,o;typeof e=="string"&&(e=t(n,"_response").canonicalize(e)),o=[],o.push(t(n,"_strategy").deserialize(e)),o.push(t(n,"_session").start(e));for(var u=0,a=t(t(n,"_handlers"),"signInSuccess").length;u<a;++u)s=t(t(n,"_handlers"),"signInSuccess")[u],o.push(s(e));return t(Em,"RSVP").all(o).then(function(){return r(e)}).fail(function(){return i(e)})}))},destroySession:function(e){var n;return null==e&&(e={}),new(t(t(Em,"RSVP"),"Promise"))((n=this,function(r,i){var s,o;typeof e=="string"&&(e=t(n,"_response").canonicalize(e)),o=[],o.push(t(n,"_strategy").deserialize(e)),o.push(t(n,"_session").end(e));for(var u=0,a=t(t(n,"_handlers"),"signOutSuccess").length;u<a;++u)s=t(t(n,"_handlers"),"signOutSuccess")[u],o.push(s(e));return t(Em,"RSVP").all(o).then(function(){return r(e)}).fail(function(){return i(e)})}))},addHandler:function(e,n){var r;return r="Handler type unrecognized; you passed in `"+e+"`",Em.assert(r,null!=t(this,"_handlers")[e]),r="Handler must be a function",Em.assert(r,typeof n=="function"),t(this,"_handlers")[e].pushObject(n)},removeHandler:function(e,n){var r;return r="Handler type unrecognized; you passed in `"+e+"`",Em.assert(r,null!=t(this,"_handlers")[e]),r="Handler must be a function or omitted for removing all handlers",Em.assert(r,typeof n=="function"||typeof n=="undefined"),null!=n?t(this,"_handlers")[e].removeObject(n):t(this,"_handlers")[e]=[]},_ensurePromise:function(e){return typeof t(e,"then")=="function"?e:new(t(t(Em,"RSVP"),"resolve"))(e)}}))}.call(this),void function(){var e,t=Ember.get,n=Ember.set;e=function(e){return function(){throw new(t(Em,"Error"))("Your request adapter "+this.toString()+" must implement the required method `"+e+"`")}},n(t(Em,"Auth"),"AuthRequest",Ember.Object.extend({signIn:e("signIn"),signOut:e("signOut"),send:e("send"),resolveUrl:function(e){var n;return n=t(t(this,"auth"),"baseUrl"),n&&n[t(n,"length")-1]==="/"&&(n=n.substr(0,t(n,"length")-1)),(null!=e?e[0]:void 0)==="/"&&(e=e.substr(1,t(e,"length"))),[n,e].join("/")}}))}.call(this),void function(){var e,t=Ember.get,n=Ember.set;e=function(e){return function(){throw new(t(Em,"Error"))("Your response adapter "+this.toString()+" must implement the required method `"+e+"`")}},n(t(Em,"Auth"),"AuthResponse",Ember.Object.extend({canonicalize:e("canonicalize")}))}.call(this),void function(){var e,t=Ember.get,n=Ember.set;e=function(e){return function(){throw new(t(Em,"Error"))("Your strategy adapter "+this.toString()+" must implement the required method `"+e+"`")}},n(t(Em,"Auth"),"AuthStrategy",Ember.Object.extend({serialize:e("serialize"),deserialize:e("deserialize")}))}.call(this),void function(){var e,t=Ember.get,n=Ember.set;e=function(e){return function(){throw new(t(Em,"Error"))("Your session adapter "+this.toString()+" must implement the required method `"+e+"`")}},n(t(Em,"Auth"),"AuthSession",Ember.Object.extend({init:function(){return t(this,"auth").reopen({signedIn:t(Em,"computed").alias("_session.signedIn"),userId:t(Em,"computed").alias("_session.userId"),startTime:t(Em,"computed").alias("_session.startTime"),endTime:t(Em,"computed").alias("_session.endTime")}),t(this,"auth").addHandler("signInSuccess",t(this,"start")),t(this,"auth").addHandler("signOutSuccess",t(this,"end"))},signedIn:!1,userId:null,startTime:null,endTime:null,start:function(){return n(this,"signedIn",!0),n(this,"startTime",new Date),n(this,"endTime",null)},end:function(){return n(this,"signedIn",!1),n(this,"userId",null),n(this,"startTime",null),n(this,"endTime",new Date)},retrieve:e("retrieve"),store:e("store"),remove:e("remove")}))}.call(this);var get$=Ember.get,set$=Ember.set;get$(Em,"Auth").reopen({response:"json",request:"jquery",strategy:"token",session:"localStorage",tokenLocation:"authHeader",tokenHeaderKey:"OAuth",modules:[],signInEndPoint:"/oauth/authorize",signOutEndPoint:"/sign-out",rememberable:{tokenKey:"access_token",autoRecall:!0},authRedirectable:{route:"sign_in"},actionRedirectable:{signInRoute:"market",signOutRoute:"landing"}}),set$(get$(Em,"Auth"),"ApplicationRoute",get$(Em,"Route").extend({renderTemplate:function(){return this.render("application")},init:function(){var e;e=localStorage.getItem("access_token");if(e)return console.log("fetched the accessToken"),get$(this,"auth").createSession(JSON.stringify({access_token:e}))},actions:{signOut:function(){var e;return e=localStorage.getItem("access_token"),get$(this,"auth").destroySession(JSON.stringify({access_token:e})),localStorage.removeItem("access_token"),localStorage.removeItem("ember-auth-rememberable")}}})),set$(get$(Em,"Auth"),"AuthenticatedRoute",get$(Em,"Route").extend({authRedirectable:!0,beforeModel:function(){if(!get$(this,"auth").get("signedIn"))return this.transitionTo("landing"),!1}})),set$(get$(Em,"Auth"),"UnauthenticatedRoute",get$(Em,"Route").extend()),set$(get$(Em,"Auth"),"SignInController",get$(Em,"Controller").extend({username:null,password:null,error:null,success:(this$=this,function(e){var t;console.log(e),console.log("success signIn"),this$.set("error",null),this$.set("username",""),this$.set("password",""),t=get$(this$,"auth").get("authToken");if(t)return get$(this$,"auth").createSession(JSON.stringify({access_token:t})),localStorage.setItem("access_token",t)}),error:(this$1=this,function(e){return console.log("fail signIn"),this$1.set("error",get$(e,"error_description"))}),actions:{signIn:function(){var e,t,n;return n=this.get("username"),t=this.get("password"),e=get$(TreggEditor,"clientId"),get$(this,"auth").signIn({data:{client_id:e,username:n,password:t,grant_type:"password"}}),get$(this,"auth").addHandler("signInSuccess",success()),get$(this,"auth").addHandler("signInError",error())},signUp:function(){var e,t,n,r,i,s,o,u;return u=this.get("newUsername"),r=this.get("newPassword"),t=this.get("newConfirmPassword"),e=get$(TreggEditor,"clientId"),i=get$(TreggEditor,"baseApiUrl")+"/sign-up",n={username:u,password:r,confirm_password:t,client_id:e},Ember.$.post(i,n,(s=this,function(e){var t;s.set("error",null),t=get$(e,"access_token");if(t)return get$(s,"auth").createSession(JSON.stringify({access_token:t})),localStorage.setItem("access_token",t),s.transitionToRoute("market")})).fail((o=this,function(e,t,n){var r;return r=JSON.parse(get$(e,"responseText")),o.set("error",get$(r,"error"))}))}}}));